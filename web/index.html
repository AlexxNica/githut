<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>parallel coordinates</title>
	<!--<link href='http://fonts.googleapis.com/css?family=PT+Sans:400' rel='stylesheet' type='text/css'>-->
	<link href="http://fonts.googleapis.com/css?family=Raleway:300,700" rel="stylesheet" type="text/css">
	<link rel="stylesheet" href="css/pc.css">
	<script src="//cdnjs.cloudflare.com/ajax/libs/d3/3.4.11/d3.min.js" charset="utf-8"></script>
	<script>window.d3||document.write('<script src="js/vendors/d3/d3.min.js"><\/script>');</script>
</head>
<body>
	<div id="load"></div>
	<div id="pc"></div>
	<script src="js/parallelcoordinates.js"></script>
	<script>
		//results-20140817-164038
		//results-20140819-123419
		//results-20140818-215136
		d3.csv("data/languages.csv",function(d){
			
			d["Year"]=+d["Year"];
			d["name_lc"]=d["Name"].toLowerCase();

			return d;
		
		},function(data){

			//console.log(data);

			var programming_languages={};
			data.forEach(function(lang){
				programming_languages[lang["name_lc"]]=lang["Year"];
			})

			//console.log(programming_languages)
			var unknonw=[];
			d3.csv("../server/exports/q2-2014.csv",function(d){
				//d.date=new Date(d.month+"-01");
				//d.timestamp=d.date.getTime();
				d.active_repos_by_url=+d.active_repos_by_url;
				d.active_repos_by_name=+d.active_repos_by_name;
				d.lang_usage=+d.lang_usage;
				d.events_per_repo=d.lang_usage / d.active_repos_by_url;
				d.sum_rep_size=(+d.sum_rep_size);
				d.sum_rep_forks=(+d.sum_rep_forks);
				d.sum_rep_openissues=(+d.sum_rep_openissues);
				d.sum_rep_watchers=(+d.sum_rep_watchers);
				//d.repository_fork=(d.repository_fork=="true")

				if(!programming_languages[d.repository_language.toLowerCase()]) {
					if(unknonw.indexOf(d.repository_language.toLowerCase())==-1) {
						unknonw.push(d.repository_language.toLowerCase())
					}
				}

				d.year=programming_languages[d.repository_language.toLowerCase()] || 1970;

				return d;
			},function(data){
				//console.log(data);
				//console.log(unknonw)
				pc=new ParallelCoordinates(data.filter(function(d){
						return true;
						return d["type"]=="PushEvent" && d.lang_usage>0 && !d.repository_fork;

					}),{ //.slice(0,100)
					programming_languages:programming_languages,
					container:"#pc",
					scale:"linear",
					columns:["name","active_repos_by_url","lang_usage","events_per_repo","sum_rep_size","sum_rep_forks","sum_rep_openissues","sum_rep_watchers","year"],
					ref:"lang_usage",
					title_column:"name",
					scale_map:{
						"year":"linear",
						"name":"ordinal",
						"name2":"ordinal",
						"active_repos_by_url":"ordinal",
						"events_per_repo":"ordinal",
						"lang_usage":"ordinal",
						"sum_rep_size":"ordinal",
						"sum_rep_forks":"ordinal",
						"sum_rep_openissues":"ordinal",
						"sum_rep_watchers":"ordinal"
					},
					use:{
						"name":"active_repos_by_url"
					},
					sorting:{
						"name":d3.descending
					},
					formats:{
						"year":"d"
					},
					dimensions:["active_repos_by_url","lang_usage","events_per_repo","year","name"],
					column_map:{
						"name":"Language",
						"active_repos_by_url":"Active Repositories",
						"lang_usage":"Events",
						"year":"Year",
						"events_per_repo":"Events/Repo",
						"sum_rep_size":"Repo Size",
						"sum_rep_forks":"Forks/Repo",
						"sum_rep_openissues":"Open Issues/Repo",
						"sum_rep_watchers":"Watchers/Repo"
					},
					duration:1000
				});

				d3.select("#load")
					.selectAll("a.load")
					.data([
						"q2-2012",
						"q3-2012",
						"q4-2012",
						"q1-2013",
						"q2-2013",
						"q3-2013",
						"q4-2013",
						"q1-2014",
						"q2-2014"
					])
					.enter()
					.append("a")
					.text(function(d){
						return d;
					})
					.attr("href","#")
					.style({
						margin:"0px 5px"
					})
					.on("click",function(d){
						d3.event.preventDefault();
						pc.loadData("../server/exports/"+d+".csv")
					})

	
			});
		});
		

	</script>
</body>
</html>